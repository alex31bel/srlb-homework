# Домашнее задание к занятию 10.6 «Disaster recovery»---### Задание 1В чём разница между DRaaS, BaaS, Active-Active, Active-Passive?*Приведите ответ в свободной форме.*#### Ответ:* **<ins>BaaS</ins>** - управляемый корпоративный облачный сервис резервного копирования. Основная цель инструмента – скорейшее восстановление файлов, папок и целых хранилищ данных при полной или частичной потере. Сервис предназначен для долгосрочной перспективы. Поэтому восстановление больших объемов данных занимает некоторое время.* Облачные предложения **<ins>DRaaS</ins>** разработаны с целью быстрой регенерации инфраструктуры посредством высокой скорости аварийного восстановления и минимизации потери данных. DRaaS создает виртуальную копию операционной системы с незамедлительным доступом по запросу.* **<ins>Active-Active</ins>:** Клиентские машины подключаются к балансировщику нагрузки, который распределяет их рабочие среды между несколькими активными серверами.* **<ins>Active-Passive</ins>:** Клиентские машины подключаются к главному серверу, который управляет всей рабочей средой, в то время как резервный сервер остается в режиме ожидания, активируясь только в случае сбоя.---### Задание 2Компании нужно составить план восстановления в случае Disaster recovery. Сервер состоит из системного диска и диска с данными. Требуется копировать два логических диска на один физический: - системный диск (C:) (20 гигабайт);- диск с данными (D:) (256 гигабайт). В требованиях говорится: - данные критичны в течение 24 часов после аварии;- сеть критична к большим потокам данных в рабочее время;- рабочее время с 9.00 до 18.00, пять дней (понедельник – пятница);- план резервирования должен быть реализован для диска C и для диска D. В случае Linux-систем /dev/sda1, /dev/sda4 или /dev/sdb1-данные;- считается, что для этой задачи может быть: 1) поставлен второй сервер или 2) выбрана облачная инфраструктура с определённой услугой;- компания готова платить за 10 терабайт места как в одном, так и в другом случае. *Приведите ответ в форме плана востановления с выбранным механизмом и получившейся топологией.*#### Ответ:Я выберу второй сервер. На обоих серверах настрою R-sync. Системные разделы (/dev/sda1 и /dev/sda4) будем копировать один раз в неделю в воскресенье, а раздел с данными будем ежедневно копировать способом Incremental Backup как изучали ранее.---# Задания со звёздочкой*Эти задания дополнительные. Их выполнять не обязательно. На зачёт это не повлияет. Вы можете их выполнить, если хотите глубже разобраться в материале. ### Задание 3*Используя программу R-sync, составьте конфигурацию для выполнения прошлой задачи.*Пришлите файл конфигурации.*#### Ответ:<ins>Первый сервер тот на котором хранятся файлы.</ins><ins>Второй сервер для хранения бекапов.</ins>Устанавливаем на обоих серверах R-sync, на втором создаем ssh ключ и переносим его на первый сервер для авторизации R-sync.На втором сервере создаём 2 файла backup-system.sh и backup-file.sh:**/home/mashkov/backup-file.sh**```bash#!/bin/bashdate# Папка, куда будем складывать архивыsyst_dir=/backup/# Имя сервера, который архивируемsrv_name=debian1# Адрес сервера, который архивируемsrv_ip=192.168.88.202# Пользователь rsync на сервере, который архивируемsrv_user=mashkov# Ресурс на сервере для бэкапаsrv_dir=/mnt/sdb1echo "Start backup ${srv_name}"# Создаем папку для инкрементных бэкаповmkdir -p ${syst_dir}${srv_name}/increment/# Запускаем непосредственно бэкап с параметрамиrsync -avzhe ssh ${srv_user}@${srv_ip}:${srv_dir} ${syst_dir}${srv_name}/current/ --backup --backup-dir=${syst_dir}${srv_name}/increment/`date +%Y-%m-%d`/# Чистим папки с инкрементными архивами старше 30-ти дней/usr/bin/find ${syst_dir}${srv_name}/increment/ -maxdepth 1 -type d -mtime +30 -exec rm -rf {} \;dateecho "Finish backup ${srv_name}"```**/home/mashkov/backup-system.sh**```bash#!/bin/bashdatessh_auth=mashkov@192.168.88.202ssh $ssh_auth 'sudo mkdir /mnt/sdb1/$(date +"%d-%m-%Y")'#Создаём образ диска с помощью ddssh $ssh_auth 'sudo dd if=/dev/sda1 of=/mnt/sdb1/$(date +"%d-%m-%Y")/sda1.img bs=8M conv=sync,noerror'ssh $ssh_auth 'sudo dd if=/dev/sda4 of=/mnt/sdb1/$(date +"%d-%m-%Y")/sda4.img bs=8M conv=sync,noerror'#Переносим созданные образы на backup серверrsync -av $ssh_auth:/mnt/sdb1/$(date +"%d-%m-%Y")/ /backup/img/ssh $ssh_auth 'sudo rm -rf /mnt/sdb1/$(date +"%d-%m-%Y")'# Чистим папки с архивами старше 30-ти дней/usr/bin/find /backup/img/ -maxdepth 1 -type d -mtime +30 -exec rm -rf {} \;```Добавляем в crontab задания.Первое будет выполняться ежедневно в полночь, а второе 1 раз в неделю в воскресенье в 23:00```bash0 0 * * * /home/mashkov/backup-file.sh0 23 * * 7 /home/mashkov/backup-system.sh```